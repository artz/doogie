angular.module("doogie",["doogie.templates","ngResource"]),function(e){"use strict";var t={days:5,host:"http://localhost:3001/api/",legend:!0};e.fn.doogieboard=function(n){var s=!!jQuery.timeago;n=n||{},n=e.extend({},t,n),(isNaN(n.days)||n.days<1)&&(n.days=t.days);var o=e.get(n.host+"events",{__populate:"_status _service",__sort:"-createdAt"}),a=e.get(n.host+"services",{__sort:"name"}),r=e.get(n.host+"statuses",{__sort:"level"});this.each(function(t,i){var l=n.days,c=e(i).addClass("doogieboard"),d=e('<table class="table"></table>'),u=e("<thead><tr></tr></thead>"),m=e("<tbody></tbody>");u.append("<th>Service</th>");for(var f=0,p=l;p>f;f+=1){var v;v=0===f?"Today":1===f?"Yesterday":f+" days ago",u.append("<th>"+v+"</th>")}e.when(o,a,r).done(function(t,o,a){var r={};o=o[0];for(var i=0,f=o.length;f>i;i+=1){var p=new Date,v=o[i];r[v._id]={};var g=e("<tr></tr>");g.append('<td class="service-name">'+v.name+"</td>");for(var h=0,b=l;b>h;h+=1){var y=e('<td class="daysago-'+h+'"><span class="doogieboard-badge"><b class="event-count">0</b></span></td>');y.data("eventCount",0),y.data("date",p),r[v._id][p.getMonth()+"-"+p.getDate()]=y,g.append(y),p.setDate(p.getDate()-1)}m.append(g)}t=t[0];for(var _,i=0,f=t.length;f>i;i+=1){_=t[i];var w=new Date(_.createdAt),y=r[_._service._id][w.getMonth()+"-"+w.getDate()];y.data("hasEvents")||(y.data("hasEvents",!0),y.addClass("doogieboard-events"),y.addClass("level-"+_._status.level));var k=y.data("eventCount")+1;y.data("eventCount",k),y.find(".event-count").html(k),y.append('<div class="event"><b class="status">'+_._status.name+'</b> <time class="timeago" datetime="'+w.toISOString()+'">'+w.getMonth()+"/"+w.getDate()+" "+w.getHours()+":"+w.getMinutes()+"</time><p>"+_.message+"</p></div>")}if(d.append(u),d.append(m),c.append(d),n.legend){a=a[0];for(var S=e('<ul class="status-list"></ul>'),i=0,f=a.length;f>i;i+=1){var T=a[i];S.append('<li class="status-item level-'+T.level+'"><b>'+T.name+"</b> <i>"+T.description+"</li>")}S.wrap('<div class="legend"></div>'),S.prepend("<h2>Status Legend</h2>"),c.append(S)}s&&c.find(".timeago").timeago();var x,E;c.on("click","td.doogieboard-events",function(){var t=e(this);if(x&&(x.removeClass("events-open"),E.remove(),x[0]===t[0]))return void(x=E=void 0);t.addClass("events-open"),x=t;var n=t.parent(),s=t.data("date");s=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear(),E=e('<tr class="doogieboard-info"><td><span class="date">'+s+'</span></td><td colspan="'+l+'">'+t.html()+"</td></tr>"),n.after(E)})})})}}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){if(!e.contains(document.documentElement,this))return e(this).timeago("dispose"),this;var t=n(this),r=a.settings;return isNaN(t.datetime)||(0==r.cutoff||Math.abs(o(t.datetime))<r.cutoff)&&e(this).text(s(t.datetime)),this}function n(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:a.datetime(t)});var n=e.trim(t.text());a.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(n.length>0)||a.isTime(t)&&t.attr("title")||t.attr("title",n)}return t.data("timeago")}function s(e){return a.inWords(o(e))}function o(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return s(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var a=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function n(n,o){var a=e.isFunction(n)?n(o,t):n,r=s.numbers&&s.numbers[o]||o;return a.replace(/%d/i,r)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var s=this.settings.strings,o=s.prefixAgo,a=s.suffixAgo;if(this.settings.allowFuture&&0>t&&(o=s.prefixFromNow,a=s.suffixFromNow),!this.settings.allowPast&&t>=0)return this.settings.strings.inPast;var r=Math.abs(t)/1e3,i=r/60,l=i/60,c=l/24,d=c/365,u=45>r&&n(s.seconds,Math.round(r))||90>r&&n(s.minute,1)||45>i&&n(s.minutes,Math.round(i))||90>i&&n(s.hour,1)||24>l&&n(s.hours,Math.round(l))||42>l&&n(s.day,1)||30>c&&n(s.days,Math.round(c))||45>c&&n(s.month,1)||365>c&&n(s.months,Math.round(c/30))||1.5>d&&n(s.year,1)||n(s.years,Math.round(d)),m=s.wordSeparator||"";return void 0===s.wordSeparator&&(m=" "),e.trim([o,u,a].join(m))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(t){var n=e(t).attr(a.isTime(t)?"datetime":"title");return a.parse(n)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var r={init:function(){var n=e.proxy(t,this);n();var s=a.settings;s.refreshMillis>0&&(this._timeagoInterval=setInterval(n,s.refreshMillis))},update:function(n){var s=a.parse(n);e(this).data("timeago",{datetime:s}),a.settings.localeTitle&&e(this).attr("title",s.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:a.parse(e(this).attr(a.isTime(this)?"datetime":"title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var n=e?r[e]:r.init;if(!n)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){n.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")}),angular.module("doogie").directive("doogieBoard",["$timeout",function(){function e(e,t){t.doogieboard()}var t={link:e};return t}]),angular.module("doogie").directive("doogieChecks",function(){function e(e,t){function n(){s.checks=t.query()}var s=this;n(),s.services=e.query({__sort:"name"}),s.check={},s.create=function(e){new t(e).$save().then(function(){n(),s.check={}})},s.update=function(e){e.$save().then(n)},s["delete"]=function(e){e.$delete().then(function(){n()})}}var t={scope:{},templateUrl:"templates/doogieChecks.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieEvents",function(){function e(e,t,n){function s(){o.events=e.query()}var o=this;s(),o.services=n.query({__sort:"name"}),o.statuses=t.query({__sort:"level"}),o.event={},o.create=function(t){new e(t).$save().then(function(){s(),o.event={}})},o.update=function(e,t){e.$save().then(s),t.preventDefault()},o["delete"]=function(e){e.$delete().then(function(){s()})}}var t={scope:{},templateUrl:"templates/doogieEvents.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieServices",function(){function e(e){function t(){n.services=e.query()}var n=this;t(),n.service={},n.create=function(s){new e(s).$save().then(function(){t(),n.service={}})},n.update=function(e){e.$save().then(t)},n["delete"]=function(e){e.$delete().then(function(){t()})}}var t={scope:{},templateUrl:"templates/doogieServices.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieStatuses",function(){function e(e){function t(){n.statuses=e.query()}var n=this;t(),n.status={},n.create=function(s){new e(s).$save().then(function(){t(),n.status={}})},n.update=function(e){e.$save().then(t)},n["delete"]=function(e){e.$delete().then(function(){t()})}}var t={scope:{},templateUrl:"templates/doogieStatuses.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").factory("Check",["Resource",function(e){return e("checks/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Event",["Resource",function(e){return e("events/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Resource",["$resource",function(e){return function(t,n,s){t="/api/"+t;var o={update:{method:"put"},create:{method:"post"}};s=angular.extend(o,s);var a=e(t,n,s);return a.prototype.$save=function(e){return this._id?this.$update(e):this.$create(e)},a}}]),angular.module("doogie").factory("Service",["Resource",function(e){return e("services/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Status",["Resource",function(e){return e("statuses/:_id",{_id:"@_id"})}]),angular.module("doogie.templates",[]).run(["$templateCache",function(e){e.put("templates/doogieChecks.html",'<h2>Checks</h2>\n  method: { type: String, required: true, default: \'GET\' },\n  headers: {},\n  params: {},\n  body: String,\n  successCode: String,\n  errorCode: String,\n  successResponseTime: Number,\n  errorResponseTime: Number,\n<form class="form-inline" ng-repeat="check in self.checks | orderBy: \'url\'">\n  <div class="form-group">\n    <select class="form-control" ng-model="check._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="check.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="http://www.yourcheck.com" ng-model="check.url">\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="check.method">\n      <option value="GET">GET</option>\n      <option value="POST">POST</option>\n      <option value="PUT">PUT</option>\n      <option value="DELETE">DELETE</option>\n    </select>\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(check)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(check)">Delete</button>\n  </div>\n</form>\n<form class="form-inline">\n  <div class="form-group">\n    <select class="form-control" ng-model="self.check._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.check.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="http://www.yourcheck.com" ng-model="self.check.url">\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="check.method">\n      <option value="GET">GET</option>\n      <option value="POST">POST</option>\n      <option value="PUT">PUT</option>\n      <option value="DELETE">DELETE</option>\n    </select>\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.check)">Add</button>\n  </div>\n</form>\n'),e.put("templates/doogieEvents.html",'<h2>Events</h2>\n<form class="form-inline">\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="self.event.message">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.event)">Send</button>\n  </div>\n</form>\n<form class="form-inline" ng-repeat="event in self.events | orderBy : \'createdAt\' : true ">\n	<div class="form-group">\n    <select class="form-control" ng-model="event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="event.message">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(event, $event)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(event)">Delete</button>\n  </div>\n</form>\n'),e.put("templates/doogieServices.html",'<h2>Services</h2>\n<form class="form-inline" ng-repeat="service in self.services | orderBy: \'name\'">\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="service.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="service.description">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(service)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(service)">Delete</button>\n  </div>\n</form>\n<form class="form-inline">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.service.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="self.service.description">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.service)">Add</button>\n  </div>\n</form>\n'),e.put("templates/doogieStatuses.html",'<h2>Statuses</h2>\n<form class="form-inline" ng-repeat="status in self.statuses | orderBy : \'level\'">\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="status.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="status.description">\n  </div>\n  <div class="form-group">\n    <input type="number" class="form-control" placeholder="0" ng-model="status.level">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(status)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(status)">Delete</button>\n  </div>\n</form>\n<form class="form-inline">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.status.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="self.status.description">\n  </div>\n  <div class="form-group">\n    <input type="number" class="form-control" placeholder="0" ng-model="self.status.level">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.status)">Add</button>\n  </div>\n</form>\n\n')}]);
//# sourceMappingURL=doogie.min.js.map