angular.module("doogie",["doogie.templates","ngSanitize","ngResource","ngRoute"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"templates/dashboard.html"}).when("/admin",{templateUrl:"templates/admin.html"}).otherwise({redirectTo:"/"})}]),function(e){"use strict";function t(e){var t=e.getHours(),n=e.getMinutes(),s=t>=12?"pm":"am";return t%=12,t=t?t:12,n=10>n?"0"+n:n,t+":"+n+s}var n={days:5,host:"/api/",legend:!0};e.fn.doogieboard=function(s){var o=!!jQuery.timeago;s=s||{},s=e.extend({},n,s),(isNaN(s.days)||s.days<1)&&(s.days=n.days);var a=e.get(s.host+"events",{__populate:"_status _service",__sort:"-createdAt"}),r=e.get(s.host+"services",{__populate:"_lastStatus",__sort:"name"}),i=e.get(s.host+"statuses",{__sort:"level"});this.each(function(n,l){var c=s.days,d=e(l).addClass("doogieboard"),u=e('<table class="table"></table>'),m=e("<thead></thead>"),f=e("<tr></tr>"),v=e("<tbody></tbody>");f.append("<th>Service</th>");for(var p=0,g=c;g>p;p+=1){var h;h=0===p?"Today":1===p?"Yesterday":p+" days ago",f.append("<th>"+h+"</th>")}m.append(f),e.when(a,r,i).done(function(n,a,r){var i={};a=a[0];for(var l=0,f=a.length;f>l;l+=1){var p=new Date,g=a[l];i[g._id]={};var h=e("<tr></tr>");h.append('<td class="service-name">'+g.name+"</td>");for(var b=0,y=c;y>b;b+=1){var _=e('<td class="doogieboard-day daysago-'+b+'"><span class="doogieboard-badge"><b class="event-count"></b></span></td>');_.data("eventCount",0),_.data("date",p),i[g._id][p.getMonth()+"-"+p.getDate()]=_,h.append(_),p.setDate(p.getDate()-1),0===b&&g._lastStatus&&_.addClass("level-"+g._lastStatus.level)}v.append(h)}n=n[0];for(var k,l=0,f=n.length;f>l;l+=1){k=n[l];var w=new Date(k.createdAt),_=i[k._service._id][w.getMonth()+"-"+w.getDate()];_.data("hasEvents")||(_.data("hasEvents",!0),_.addClass("doogieboard-events"),_.addClass("level-"+k._status.level));var x=_.data("eventCount")+1;_.data("eventCount",x),_.find(".event-count").html(x),_.append('<div class="event level-'+k._status.level+'"><h5><b class="status">'+k._status.name+"</b> <small>at "+t(w)+', <time class="timeago" datetime="'+w.toISOString()+'">'+w.getMonth()+"/"+w.getDate()+" "+w.getHours()+":"+w.getMinutes()+'</time></small></h5><p class="message">'+k.message+"</p></div>")}if(u.append(m),u.append(v),d.append(u),s.legend){r=r[0];for(var T=e('<ul class="status-list"></ul>'),l=0,f=r.length;f>l;l+=1){var S=r[l];T.append('<li class="status-item level-'+S.level+'"><b>'+S.name+"</b> <i>"+S.description+"</li>")}T.wrap('<div class="legend"></div>'),T.prepend("<h2>Status Legend</h2>"),d.append(T)}o&&d.find(".timeago").timeago();var E,$;d.on("click","td.doogieboard-events",function(){var t=e(this);if(E&&(E.removeClass("events-open active"),$.remove(),E[0]===t[0]))return void(E=$=void 0);t.addClass("events-open active"),E=t;var n=t.parent(),s=t.data("date");s=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear(),$=e('<tr class="doogieboard-info active"><td><span class="date">'+s+'</span></td><td colspan="'+c+'">'+t.html()+"</td></tr>"),n.after($)})})})}}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){if(!e.contains(document.documentElement,this))return e(this).timeago("dispose"),this;var t=n(this),r=a.settings;return isNaN(t.datetime)||(0==r.cutoff||Math.abs(o(t.datetime))<r.cutoff)&&e(this).text(s(t.datetime)),this}function n(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:a.datetime(t)});var n=e.trim(t.text());a.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(n.length>0)||a.isTime(t)&&t.attr("title")||t.attr("title",n)}return t.data("timeago")}function s(e){return a.inWords(o(e))}function o(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return s(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var a=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function n(n,o){var a=e.isFunction(n)?n(o,t):n,r=s.numbers&&s.numbers[o]||o;return a.replace(/%d/i,r)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var s=this.settings.strings,o=s.prefixAgo,a=s.suffixAgo;if(this.settings.allowFuture&&0>t&&(o=s.prefixFromNow,a=s.suffixFromNow),!this.settings.allowPast&&t>=0)return this.settings.strings.inPast;var r=Math.abs(t)/1e3,i=r/60,l=i/60,c=l/24,d=c/365,u=45>r&&n(s.seconds,Math.round(r))||90>r&&n(s.minute,1)||45>i&&n(s.minutes,Math.round(i))||90>i&&n(s.hour,1)||24>l&&n(s.hours,Math.round(l))||42>l&&n(s.day,1)||30>c&&n(s.days,Math.round(c))||45>c&&n(s.month,1)||365>c&&n(s.months,Math.round(c/30))||1.5>d&&n(s.year,1)||n(s.years,Math.round(d)),m=s.wordSeparator||"";return void 0===s.wordSeparator&&(m=" "),e.trim([o,u,a].join(m))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(t){var n=e(t).attr(a.isTime(t)?"datetime":"title");return a.parse(n)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var r={init:function(){var n=e.proxy(t,this);n();var s=a.settings;s.refreshMillis>0&&(this._timeagoInterval=setInterval(n,s.refreshMillis))},update:function(n){var s=a.parse(n);e(this).data("timeago",{datetime:s}),a.settings.localeTitle&&e(this).attr("title",s.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:a.parse(e(this).attr(a.isTime(this)?"datetime":"title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var n=e?r[e]:r.init;if(!n)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){n.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")}),angular.module("doogie").controller("navController",["$location",function(e){this.isActive=function(t){return t===e.path()}}]),angular.module("doogie").directive("doogieBar",function(){function e(e,t,n){function s(){o.events=e.query()}var o=this;s(),o.services=n.query({__sort:"name"}),o.statuses=t.query({__sort:"level"}),o.event={},o.create=function(t){new e(t).$save().then(function(){s(),o.event={}})},o.update=function(e){e.$save().then(s)},o["delete"]=function(e){e.$delete().then(function(){s()})}}var t={scope:{},templateUrl:"templates/doogieBar.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieBoard",["$timeout",function(){function e(e,t,n){var s="false"!==n.legend;t.doogieboard({legend:s})}var t={link:e};return t}]),angular.module("doogie").directive("doogieChecks",function(){function e(e,t){function n(){s.checks=t.query()}var s=this;n(),s.services=e.query({__sort:"name"}),s.check={method:"GET",successCode:"^2[0-9][0-9]$",successResponseTime:1e3,errorResponseTime:6e3},s.create=function(e){new t(e).$save().then(function(){n(),s.check={}})},s.update=function(e){e.$save().then(n)},s["delete"]=function(e){e.$delete().then(function(){n()})}}var t={scope:{},templateUrl:"templates/doogieChecks.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieEvents",function(){function e(e,t,n){function s(){o.events=e.query()}var o=this;s(),o.services=n.query({__sort:"name"}),o.statuses=t.query({__sort:"level"}),o.event={},o.create=function(t){new e(t).$save().then(function(){s(),o.event={}})},o.update=function(e){e.$save().then(s)},o["delete"]=function(e){e.$delete().then(function(){s()})}}var t={scope:{},templateUrl:"templates/doogieEvents.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieServices",function(){function e(e){function t(){n.services=e.query()}var n=this;t(),n.service={},n.create=function(s){new e(s).$save().then(function(){t(),n.service={}})},n.update=function(e){e.$save().then(t)},n["delete"]=function(e){e.$delete().then(function(){t()})}}var t={scope:{},templateUrl:"templates/doogieServices.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieStatuses",function(){function e(e){function t(){n.statuses=e.query()}var n=this;t(),n.status={},n.create=function(s){new e(s).$save().then(function(){t(),n.status={}})},n.update=function(e){e.$save().then(t)},n["delete"]=function(e){e.$delete().then(function(){t()})}}var t={scope:{},templateUrl:"templates/doogieStatuses.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").factory("Check",["Resource",function(e){return e("checks/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Event",["Resource",function(e){return e("events/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Resource",["$resource",function(e){return function(t,n,s){t="/api/"+t;var o={update:{method:"put"},create:{method:"post"}};s=angular.extend(o,s);var a=e(t,n,s);return a.prototype.$save=function(e){return this._id?this.$update(e):this.$create(e)},a}}]),angular.module("doogie").factory("Service",["Resource",function(e){return e("services/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Status",["Resource",function(e){return e("statuses/:_id",{_id:"@_id"})}]),angular.module("doogie.templates",[]).run(["$templateCache",function(e){e.put("templates/admin.html","<doogie-events></doogie-events>\n<doogie-checks></doogie-checks>\n<doogie-services></doogie-services>\n<doogie-statuses></doogie-statuses>\n"),e.put("templates/dashboard.html",'<doogie-board legend="false"></doogie-board>\n'),e.put("templates/doogieBar.html",'<form class="navbar-form navbar-left">\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="self.event.message" size="60">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.event)">Send</button>\n  </div>\n</form>\n'),e.put("templates/doogieChecks.html",'<h2>Checks</h2>\n\n<form class="form-inline">\n  <div class="form-group">\n    <select class="form-control" ng-model="self.check._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.check.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="http://www.yourcheck.com" ng-model="self.check.url">\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="self.check.method">\n      <option value="GET">GET</option>\n      <option value="POST">POST</option>\n      <option value="PUT">PUT</option>\n      <option value="DELETE">DELETE</option>\n    </select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" ng-model="self.check.successCode" size="6">\n    <input type="text" class="form-control" ng-model="self.check.successResponseTime" size="4">\n    <input type="text" class="form-control" ng-model="self.check.errorResponseTime" size="4">\n  </div>\n  <div class="form-group">\n    <button class="btn btn-primary" ng-click="self.create(self.check)">Add</button>\n  </div>\n</form>\n\n<form class="form-inline" ng-repeat="check in self.checks">\n  <div class="form-group">\n    <select class="form-control" ng-model="check._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="check.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="http://www.yourcheck.com" ng-model="check.url">\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="check.method">\n      <option value="GET">GET</option>\n      <option value="POST">POST</option>\n      <option value="PUT">PUT</option>\n      <option value="DELETE">DELETE</option>\n    </select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" ng-model="check.successCode" size="6">\n    <input type="text" class="form-control" ng-model="check.successResponseTime" size="4">\n    <input type="text" class="form-control" ng-model="check.errorResponseTime" size="4">\n  </div>\n  <div class="form-group">\n	  <button class="btn btn-default" ng-click="self.update(check)">Save</button>\n	  <button class="btn btn-danger" ng-click="self.delete(check)">Delete</button>\n  </div>\n</form>\n\n'),e.put("templates/doogieEvents.html",'<h2>Events</h2>\n\n<form class="form-inline">\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="self.event.message" size="60">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.event)">Send</button>\n  </div>\n</form>\n<form class="form-inline" ng-repeat="event in self.events">\n	<div class="form-group">\n    <select class="form-control" ng-model="event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="event.message" size="60">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(event)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(event)">Delete</button>\n  </div>\n</form>\n'),e.put("templates/doogieServices.html",'<h2>Services</h2>\n\n<form class="form-inline">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.service.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="self.service.description" size="60">\n  </div>\n  <div class="form-group">\n    <button class="btn btn-primary" ng-click="self.create(self.service)">Add</button>\n  </div>\n</form>\n\n<form class="form-inline" ng-repeat="service in self.services | orderBy: \'name\'">\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="service.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="service.description" size="60">\n  </div>\n  <div class="form-group">\n	  <button class="btn btn-default" ng-click="self.update(service)">Save</button>\n	  <button class="btn btn-danger" ng-click="self.delete(service)">Delete</button>\n  </div>\n</form>\n'),e.put("templates/doogieStatuses.html",'<h2>Statuses</h2>\n\n<form class="form-inline">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.status.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="self.status.description" size="52">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="0" ng-model="self.status.level" size="2">\n  </div>\n  <div class="form-group">\n    <button class="btn btn-primary" ng-click="self.create(self.status)">Add</button>\n  </div>\n</form>\n\n<form class="form-inline" ng-repeat="status in self.statuses">\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="status.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="status.description" size="52">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="0" ng-model="status.level" size="2">\n  </div>\n  <div class="form-group">\n	  <button class="btn btn-default" ng-click="self.update(status)">Save</button>\n	  <button class="btn btn-danger" ng-click="self.delete(status)">Delete</button>\n  </div>\n</form>\n')}]);
//# sourceMappingURL=doogie.min.js.map