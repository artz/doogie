angular.module("doogie",["doogie.templates","ngResource"]),function(e){"use strict";var t={days:5,host:"http://localhost:3001/api/",legend:!0};e.fn.doogieboard=function(n){var s=!!jQuery.timeago;n=n||{},n=e.extend({},t,n),(isNaN(n.days)||n.days<1)&&(n.days=t.days);var a=e.get(n.host+"events",{__populate:"_status _service",__sort:"-createdAt"}),o=e.get(n.host+"services",{__sort:"name"}),r=e.get(n.host+"statuses",{__sort:"level"});this.each(function(t,i){var l=n.days,d=e(i).addClass("doogieboard"),u=e('<table class="table"></table>'),c=e("<thead><tr></tr></thead>"),m=e("<tbody></tbody>");c.append("<th>Service</th>");for(var f=0,v=l;v>f;f+=1){var p;p=0===f?"Today":1===f?"Yesterday":f+" days ago",c.append("<th>"+p+"</th>")}e.when(a,o,r).done(function(t,a,o){var r={};a=a[0];for(var i=0,f=a.length;f>i;i+=1){var v=new Date,p=a[i];r[p._id]={};var g=e("<tr></tr>");g.append('<td class="service-name">'+p.name+"</td>");for(var h=0,b=l;b>h;h+=1){var y=e('<td class="daysago-'+h+'"><span class="doogieboard-badge"><b class="event-count">0</b></span></td>');y.data("eventCount",0),y.data("date",v),r[p._id][v.getMonth()+"-"+v.getDate()]=y,g.append(y),v.setDate(v.getDate()-1)}m.append(g)}t=t[0];for(var _,i=0,f=t.length;f>i;i+=1){_=t[i];var w=new Date(_.createdAt),y=r[_._service._id][w.getMonth()+"-"+w.getDate()];y.data("hasEvents")||(y.data("hasEvents",!0),y.addClass("doogieboard-events"),y.addClass("level-"+_._status.level));var x=y.data("eventCount")+1;y.data("eventCount",x),y.find(".event-count").html(x),y.append('<div class="event"><b class="status">'+_._status.name+'</b> <time class="timeago" datetime="'+w.toISOString()+'">'+w.getMonth()+"/"+w.getDate()+" "+w.getHours()+":"+w.getMinutes()+"</time><p>"+_.message+"</p></div>")}if(u.append(c),u.append(m),d.append(u),n.legend){o=o[0];for(var S=e('<ul class="status-list"></ul>'),i=0,f=o.length;f>i;i+=1){var D=o[i];S.append('<li class="status-item level-'+D.level+'"><b>'+D.name+"</b> <i>"+D.description+"</li>")}S.wrap('<div class="legend"></div>'),S.prepend("<h2>Status Legend</h2>"),d.append(S)}s&&d.find(".timeago").timeago();var $,M;d.on("click","td.doogieboard-events",function(){var t=e(this);if($&&($.removeClass("events-open"),M.remove(),$[0]===t[0]))return void($=M=void 0);t.addClass("events-open"),$=t;var n=t.parent(),s=(t.find(".event"),t.data("date"));s=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear(),M=e('<tr class="doogieboard-info"><td><span class="date">'+s+'</span></td><td colspan="'+l+'">'+t.html()+"</td></tr>"),n.after(M)})})})}}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){if(!e.contains(document.documentElement,this))return e(this).timeago("dispose"),this;var t=n(this),r=o.settings;return isNaN(t.datetime)||(0==r.cutoff||Math.abs(a(t.datetime))<r.cutoff)&&e(this).text(s(t.datetime)),this}function n(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:o.datetime(t)});var n=e.trim(t.text());o.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(n.length>0)||o.isTime(t)&&t.attr("title")||t.attr("title",n)}return t.data("timeago")}function s(e){return o.inWords(a(e))}function a(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return s(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var o=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function n(n,a){var o=e.isFunction(n)?n(a,t):n,r=s.numbers&&s.numbers[a]||a;return o.replace(/%d/i,r)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var s=this.settings.strings,a=s.prefixAgo,o=s.suffixAgo;if(this.settings.allowFuture&&0>t&&(a=s.prefixFromNow,o=s.suffixFromNow),!this.settings.allowPast&&t>=0)return this.settings.strings.inPast;var r=Math.abs(t)/1e3,i=r/60,l=i/60,d=l/24,u=d/365,c=45>r&&n(s.seconds,Math.round(r))||90>r&&n(s.minute,1)||45>i&&n(s.minutes,Math.round(i))||90>i&&n(s.hour,1)||24>l&&n(s.hours,Math.round(l))||42>l&&n(s.day,1)||30>d&&n(s.days,Math.round(d))||45>d&&n(s.month,1)||365>d&&n(s.months,Math.round(d/30))||1.5>u&&n(s.year,1)||n(s.years,Math.round(u)),m=s.wordSeparator||"";return void 0===s.wordSeparator&&(m=" "),e.trim([a,c,o].join(m))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(t){var n=e(t).attr(o.isTime(t)?"datetime":"title");return o.parse(n)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var r={init:function(){var n=e.proxy(t,this);n();var s=o.settings;s.refreshMillis>0&&(this._timeagoInterval=setInterval(n,s.refreshMillis))},update:function(n){var s=o.parse(n);e(this).data("timeago",{datetime:s}),o.settings.localeTitle&&e(this).attr("title",s.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:o.parse(e(this).attr(o.isTime(this)?"datetime":"title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var n=e?r[e]:r.init;if(!n)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){n.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")}),angular.module("doogie").directive("doogieBoard",["$timeout",function(){function e(e,t){t.doogieboard()}var t={link:e};return t}]),angular.module("doogie").directive("doogieEvents",function(){function e(e,t,n){function s(){a.events=e.query()}var a=this;s(),a.services=n.query({__sort:"name"}),a.statuses=t.query({__sort:"level"}),a.event={},a.create=function(t){new e(t).$save().then(function(){s(),a.event={}})},a.update=function(e,t){e.$save().then(s),t.preventDefault()},a["delete"]=function(e){e.$delete().then(function(){s()})}}var t={scope:{},templateUrl:"templates/doogieEvents.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieServices",function(){function e(e){function t(){n.services=e.query()}var n=this;t(),n.service={},n.create=function(s){new e(s).$save().then(function(){t(),n.service={}})},n.update=function(e){e.$save().then(t)},n["delete"]=function(e){e.$delete().then(function(){t()})}}var t={scope:{},templateUrl:"templates/doogieServices.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").directive("doogieStatuses",function(){function e(e){function t(){n.statuses=e.query()}var n=this;t(),n.status={},n.create=function(s){new e(s).$save().then(function(){t(),n.status={}})},n.update=function(e){e.$save().then(t)},n["delete"]=function(e){e.$delete().then(function(){t()})}}var t={scope:{},templateUrl:"templates/doogieStatuses.html",controller:e,controllerAs:"self"};return t}),angular.module("doogie").factory("Event",["Resource",function(e){return e("events/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Resource",["$resource",function(e){return function(t,n,s){t="/api/"+t;var a={update:{method:"put"},create:{method:"post"}};s=angular.extend(a,s);var o=e(t,n,s);return o.prototype.$save=function(e){return this._id?this.$update(e):this.$create(e)},o}}]),angular.module("doogie").factory("Service",["Resource",function(e){return e("services/:_id",{_id:"@_id"})}]),angular.module("doogie").factory("Status",["Resource",function(e){return e("statuses/:_id",{_id:"@_id"})}]),angular.module("doogie.templates",[]).run(["$templateCache",function(e){e.put("templates/doogieEvents.html",'<h2>Events</h2>\n<form class="form-inline">\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="self.event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="self.event.message">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.event)">Send</button>\n  </div>\n</form>\n<form class="form-inline" ng-repeat="event in self.events | orderBy : \'createdAt\' : true ">\n	<div class="form-group">\n    <select class="form-control" ng-model="event._service" ng-options="service._id as service.name for service in self.services"></select>\n  </div>\n  <div class="form-group">\n    <select class="form-control" ng-model="event._status" ng-options="status._id as status.name for status in self.statuses"></select>\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Message" ng-model="event.message">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(event, $event)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(event)">Delete</button>\n  </div>\n</form>\n'),e.put("templates/doogieServices.html",'<h2>Services</h2>\n<form class="form-inline" ng-repeat="service in self.services | orderBy: \'name\'">\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="service.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="service.description">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(service)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(service)">Delete</button>\n  </div>\n</form>\n<form class="form-inline">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.service.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="self.service.description">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.service)">Add</button>\n  </div>\n</form>\n'),e.put("templates/doogieStatuses.html",'<h2>Statuses</h2>\n<form class="form-inline" ng-repeat="status in self.statuses | orderBy : \'level\'">\n	<div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="status.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="status.description">\n  </div>\n  <div class="form-group">\n    <input type="number" class="form-control" placeholder="0" ng-model="status.level">\n  </div>\n  <div class="form-group">\n	  <button type="submit" class="btn btn-default" ng-click="self.update(status)">Save</button>\n	  <button type="submit" class="btn btn-danger" ng-click="self.delete(status)">Delete</button>\n  </div>\n</form>\n<form class="form-inline">\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Name" ng-model="self.status.name">\n  </div>\n  <div class="form-group">\n    <input type="text" class="form-control" placeholder="Description" ng-model="self.status.description">\n  </div>\n  <div class="form-group">\n    <input type="number" class="form-control" placeholder="0" ng-model="self.status.level">\n  </div>\n  <div class="form-group">\n  	<button type="submit" class="btn btn-primary" ng-click="self.create(self.status)">Add</button>\n  </div>\n</form>\n\n')}]);
//# sourceMappingURL=doogie.min.js.map