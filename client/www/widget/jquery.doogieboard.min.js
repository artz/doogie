!function(e){"use strict";function a(e){var a=e.getHours(),t=e.getMinutes(),s=a>=12?"pm":"am";return a%=12,a=a?a:12,t=10>t?"0"+t:t,a+":"+t+s}var t={days:5,host:"http://doogie.amp.aol.com/api/",sparkline:{disableInteraction:!0,width:62,height:20,lineWidth:1,lineColor:"#6b6b6b",fillColor:"#f5f5f5",chartRangeMin:0,chartRangeMax:100,spotColor:!1,minSpotColor:!1,maxSpotColor:!1}};e.fn.doogieboard=function(s){var n=!!jQuery.timeago;s=s||{},s=e.extend({},t,s),(isNaN(s.days)||s.days<1)&&(s.days=t.days);var o=e.get(s.host+"events",{__populate:"_status _service",__sort:"-createdAt"}),d=e.get(s.host+"services",{__populate:"_lastStatus",__sort:"name"}),r=e.get(s.host+"statuses",{__sort:"level"});return this.each(function(t,i){var l=s.days,v=e(i).addClass("doogieboard"),p=e('<table class="table"></table>'),g=e("<thead></thead>"),c=e("<tr></tr>"),u=e("<tbody></tbody>");c.append("<th>Service</th>");for(var h=0,m=l;m>h;h+=1){var f;f=0===h?"Today":1===h?"Yesterday":h+" days ago",c.append("<th>"+f+"</th>")}g.append(c),e.when(o,d,r).done(function(t,o,d){var r,i={};d=d[0];for(var c=0,h=d.length;h>c;c+=1)if(0===d[c].level){r=d[c];break}r||window.console&&console.log("Doogieboard Error: Please configure a level 0 status."),o=o[0];for(var c=0,h=o.length;h>c;c+=1){var m=new Date,f=o[c];i[f._id]={};var b=e("<tr></tr>");b.append('<td class="doogieboard-service-name" data-service-id="'+f._id+'"><b>'+f.name+"</b></td>");for(var _=0,y=l;y>_;_+=1){var C=e('<td class="doogieboard-day daysago-'+_+'"><span class="doogieboard-badge"><b class="event-count"></b><i class="event-status">'+r.name+"</i></span></td>");C.data("eventCount",0),C.data("date",m.toISOString()),i[f._id][m.getMonth()+"-"+m.getDate()]=C,b.append(C),m.setDate(m.getDate()-1),0===_&&f._lastStatus&&(C.addClass("level-"+f._lastStatus.level),C.find(".event-status").html(f._lastStatus.name))}u.append(b)}t=t[0];for(var S,c=0,h=t.length;h>c;c+=1){S=t[c];var D=new Date(S.createdAt),C=i[S._service._id][D.getMonth()+"-"+D.getDate()];if(C){C.data("hasEvents")||(C.data("hasEvents",!0),C.addClass("doogieboard-events"),C.addClass("level-"+S._status.level),C.find(".event-status").html(S._status.name));var k=C.data("eventCount")+1;C.data("eventCount",k),C.find(".event-count").html(k),C.append('<div class="event level-'+S._status.level+'"><h5><b class="status">'+S._status.name+"</b> <small>at "+a(D)+', <time class="timeago" datetime="'+D.toISOString()+'">'+D.getMonth()+"/"+D.getDate()+" "+D.getHours()+":"+D.getMinutes()+'</time></small></h5><p class="message">'+S.message+"</p></div>")}}if(p.append(g),p.append(u),v.append(p),v.trigger("doogieboard-ready"),s.legend){d=d[0];for(var w=e('<ul class="status-list"></ul>'),c=0,h=d.length;h>c;c+=1){var M=d[c];w.append('<li class="status-item level-'+M.level+'"><b>'+M.name+"</b> <i>"+M.description+"</li>")}w.wrap('<div class="legend"></div>'),w.prepend("<h2>Status Legend</h2>"),v.append(w)}n&&v.find(".timeago").timeago(),s.sparkline&&p.find(".doogieboard-service-name").each(function(){var a=e(this),t=a.data("serviceId");e.get(s.host+"services/"+t+"/sparkline",function(t){if(t.hourly&&t.hourly.length){var n=e('<span class="doogieboard-sparkline"></span>');a.append(n),n.sparkline(t.hourly,s.sparkline)}})});var I,x;v.on("click","td.doogieboard-events",function(){var a=e(this);if(I&&(I.removeClass("events-open active"),x.remove(),I[0]===a[0]))return void(I=x=void 0);a.addClass("events-open active"),I=a;var t=a.parent(),s=new Date(a.data("date"));s=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear(),x=e('<tr class="doogieboard-info active"><td><span class="date">'+s+'</span></td><td colspan="'+l+'">'+a.html()+"</td></tr>"),t.after(x)})})})}}(jQuery);
//# sourceMappingURL=jquery.doogieboard.min.js.map