!function(e){"use strict";function a(e){var a=e.getHours(),t=e.getMinutes(),s=a>=12?"pm":"am";return a%=12,a=a?a:12,t=10>t?"0"+t:t,a+":"+t+s}var t={days:5,host:"http://doogie-env.elasticbeanstalk.com/api/",sparkline:{disableInteraction:!0,width:62,height:20,lineWidth:1,lineColor:"#6b6b6b",fillColor:"#f5f5f5",chartRangeMin:0,chartRangeMax:100,spotColor:!1,minSpotColor:!1,maxSpotColor:!1}};e.fn.doogieboard=function(s){var n=!!jQuery.timeago;s=s||{},s=e.extend({},t,s),(isNaN(s.days)||s.days<1)&&(s.days=t.days);var d=e.get(s.host+"events",{__populate:"_status _service",__sort:"-createdAt"}),o=e.get(s.host+"services",{__populate:"_lastStatus",__sort:"name"}),i=e.get(s.host+"statuses",{__sort:"level"});this.each(function(t,r){var l=s.days,v=e(r).addClass("doogieboard"),p=e('<table class="table"></table>'),c=e("<thead></thead>"),g=e("<tr></tr>"),u=e("<tbody></tbody>");g.append("<th>Service</th>");for(var h=0,b=l;b>h;h+=1){var m;m=0===h?"Today":1===h?"Yesterday":h+" days ago",g.append("<th>"+m+"</th>")}c.append(g),e.when(d,o,i).done(function(t,d,o){var i={};d=d[0];for(var r=0,g=d.length;g>r;r+=1){var h=new Date,b=d[r];i[b._id]={};var m=e("<tr></tr>");m.append('<td class="doogieboard-service-name" data-service-id="'+b._id+'"><b>'+b.name+"</b></td>");for(var f=0,_=l;_>f;f+=1){var y=e('<td class="doogieboard-day daysago-'+f+'"><span class="doogieboard-badge"><b class="event-count"></b><i class="event-status">Online</i></span></td>');y.data("eventCount",0),y.data("date",h.toISOString()),i[b._id][h.getMonth()+"-"+h.getDate()]=y,m.append(y),h.setDate(h.getDate()-1),0===f&&b._lastStatus&&y.addClass("level-"+b._lastStatus.level)}u.append(m)}t=t[0];for(var C,r=0,g=t.length;g>r;r+=1){C=t[r];var S=new Date(C.createdAt),y=i[C._service._id][S.getMonth()+"-"+S.getDate()];if(y){y.data("hasEvents")||(y.data("hasEvents",!0),y.addClass("doogieboard-events"),y.addClass("level-"+C._status.level),y.find(".event-status").html(C._status.name));var D=y.data("eventCount")+1;y.data("eventCount",D),y.find(".event-count").html(D),y.append('<div class="event level-'+C._status.level+'"><h5><b class="status">'+C._status.name+"</b> <small>at "+a(S)+', <time class="timeago" datetime="'+S.toISOString()+'">'+S.getMonth()+"/"+S.getDate()+" "+S.getHours()+":"+S.getMinutes()+'</time></small></h5><p class="message">'+C.message+"</p></div>")}}if(p.append(c),p.append(u),v.append(p),s.legend){o=o[0];for(var k=e('<ul class="status-list"></ul>'),r=0,g=o.length;g>r;r+=1){var M=o[r];k.append('<li class="status-item level-'+M.level+'"><b>'+M.name+"</b> <i>"+M.description+"</li>")}k.wrap('<div class="legend"></div>'),k.prepend("<h2>Status Legend</h2>"),v.append(k)}n&&v.find(".timeago").timeago(),s.sparkline&&p.find(".doogieboard-service-name").each(function(){var a=e(this),t=a.data("serviceId");e.get(s.host+"services/"+t+"/sparkline",function(t){if(t.hourly&&t.hourly.length){var n=e('<span class="doogieboard-sparkline"></span>');a.append(n),n.sparkline(t.hourly,s.sparkline)}})});var w,I;v.on("click","td.doogieboard-events",function(){var a=e(this);if(w&&(w.removeClass("events-open active"),I.remove(),w[0]===a[0]))return void(w=I=void 0);a.addClass("events-open active"),w=a;var t=a.parent(),s=new Date(a.data("date"));s=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear(),I=e('<tr class="doogieboard-info active"><td><span class="date">'+s+'</span></td><td colspan="'+l+'">'+a.html()+"</td></tr>"),t.after(I)})})})}}(jQuery);
//# sourceMappingURL=jquery.doogieboard.min.js.map