!function(e){"use strict";function a(e){var a=e.getHours(),t=e.getMinutes(),s=a>=12?"pm":"am";return a%=12,a=a?a:12,t=10>t?"0"+t:t,a+":"+t+s}var t={days:5,host:"/api/",legend:!0,sparkline:{disableInteraction:!0,width:62,height:20,lineWidth:1,lineColor:"#666",fillColor:"#f5f5f5",chartRangeMin:0,chartRangeMax:100,spotColor:!1,minSpotColor:!1,maxSpotColor:!1}};e.fn.doogieboard=function(s){var d=!!jQuery.timeago;s=s||{},s=e.extend({},t,s),(isNaN(s.days)||s.days<1)&&(s.days=t.days);var n=e.get(s.host+"events",{__populate:"_status _service",__sort:"-createdAt"}),o=e.get(s.host+"services",{__populate:"_lastStatus",__sort:"name"}),r=e.get(s.host+"statuses",{__sort:"level"});this.each(function(t,i){var l=s.days,v=e(i).addClass("doogieboard"),p=e('<table class="table"></table>'),g=e("<thead></thead>"),c=e("<tr></tr>"),h=e("<tbody></tbody>");c.append("<th>Service</th>");for(var u=0,f=l;f>u;u+=1){var m;m=0===u?"Today":1===u?"Yesterday":u+" days ago",c.append("<th>"+m+"</th>")}g.append(c),e.when(n,o,r).done(function(t,n,o){var r={};n=n[0];for(var i=0,c=n.length;c>i;i+=1){var u=new Date,f=n[i];r[f._id]={};var m=e("<tr></tr>");m.append('<td class="doogieboard-service-name" data-service-id="'+f._id+'"><b>'+f.name+"</b></td>");for(var b=0,_=l;_>b;b+=1){var y=e('<td class="doogieboard-day daysago-'+b+'"><span class="doogieboard-badge"><b class="event-count"></b></span></td>');y.data("eventCount",0),y.data("date",u.toISOString()),r[f._id][u.getMonth()+"-"+u.getDate()]=y,m.append(y),u.setDate(u.getDate()-1),0===b&&f._lastStatus&&y.addClass("level-"+f._lastStatus.level)}h.append(m)}t=t[0];for(var C,i=0,c=t.length;c>i;i+=1){C=t[i];var S=new Date(C.createdAt),y=r[C._service._id][S.getMonth()+"-"+S.getDate()];y.data("hasEvents")||(y.data("hasEvents",!0),y.addClass("doogieboard-events"),y.addClass("level-"+C._status.level));var D=y.data("eventCount")+1;y.data("eventCount",D),y.find(".event-count").html(D),y.append('<div class="event level-'+C._status.level+'"><h5><b class="status">'+C._status.name+"</b> <small>at "+a(S)+', <time class="timeago" datetime="'+S.toISOString()+'">'+S.getMonth()+"/"+S.getDate()+" "+S.getHours()+":"+S.getMinutes()+'</time></small></h5><p class="message">'+C.message+"</p></div>")}if(p.append(g),p.append(h),v.append(p),s.legend){o=o[0];for(var M=e('<ul class="status-list"></ul>'),i=0,c=o.length;c>i;i+=1){var k=o[i];M.append('<li class="status-item level-'+k.level+'"><b>'+k.name+"</b> <i>"+k.description+"</li>")}M.wrap('<div class="legend"></div>'),M.prepend("<h2>Status Legend</h2>"),v.append(M)}d&&v.find(".timeago").timeago(),s.sparkline&&p.find(".doogieboard-service-name").each(function(){var a=e(this),t=a.data("serviceId");e.get(s.host+"services/"+t+"/sparkline",function(t){if(t.hourly&&t.hourly.length){var d=e('<span class="doogieboard-sparkline"></span>');a.append(d),d.sparkline(t.hourly,s.sparkline)}})});var w,I;v.on("click","td.doogieboard-events",function(){var a=e(this);if(w&&(w.removeClass("events-open active"),I.remove(),w[0]===a[0]))return void(w=I=void 0);a.addClass("events-open active"),w=a;var t=a.parent(),s=new Date(a.data("date"));s=s.getMonth()+1+"/"+s.getDate()+"/"+s.getFullYear(),I=e('<tr class="doogieboard-info active"><td><span class="date">'+s+'</span></td><td colspan="'+l+'">'+a.html()+"</td></tr>"),t.after(I)})})})}}(jQuery);
//# sourceMappingURL=jquery.doogieboard.min.js.map